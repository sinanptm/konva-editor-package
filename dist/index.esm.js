import*as e from"react";import t,{useRef as a,useState as r,useEffect as n,useMemo as s,forwardRef as i}from"react";import{Group as l,Circle as o,Text as c,Rect as d,Transformer as u,Image as g,Stage as m,Layer as x}from"react-konva";import{Slot as h}from"@radix-ui/react-slot";import{cva as f}from"class-variance-authority";import{clsx as v}from"clsx";import{twMerge as b}from"tailwind-merge";import{create as p}from"zustand";import{temporal as y}from"zundo";import j from"use-image";import{Undo as k,Redo as S,Upload as N,X as w,ChevronDownIcon as C,CheckIcon as T,ChevronUpIcon as O,AlignLeftIcon as z,AlignCenterIcon as E,AlignRightIcon as I}from"lucide-react";import*as D from"@radix-ui/react-tabs";import*as R from"@radix-ui/react-label";import*as B from"@radix-ui/react-select";import*as F from"@radix-ui/react-slider";import*as A from"@radix-ui/react-switch";import*as _ from"@radix-ui/react-separator";var V,L={exports:{}},P={};var $,U,W={};
/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function Y(){return $||($=1,"production"!==process.env.NODE_ENV&&function(){function e(t){if(null==t)return null;if("function"==typeof t)return t.$$typeof===S?null:t.displayName||t.name||null;if("string"==typeof t)return t;switch(t){case g:return"Fragment";case x:return"Profiler";case m:return"StrictMode";case b:return"Suspense";case p:return"SuspenseList";case k:return"Activity"}if("object"==typeof t)switch(t.tag,t.$$typeof){case u:return"Portal";case f:return(t.displayName||"Context")+".Provider";case h:return(t._context.displayName||"Context")+".Consumer";case v:var a=t.render;return(t=t.displayName)||(t=""!==(t=a.displayName||a.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case y:return null!==(a=t.displayName||null)?a:e(t.type)||"Memo";case j:a=t._payload,t=t._init;try{return e(t(a))}catch(e){}}return null}function a(e){return""+e}function r(e){try{a(e);var t=!1}catch(e){t=!0}if(t){var r=(t=console).error,n="function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object";return r.call(t,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",n),a(e)}}function n(t){if(t===g)return"<>";if("object"==typeof t&&null!==t&&t.$$typeof===j)return"<...>";try{var a=e(t);return a?"<"+a+">":"<...>"}catch(e){return"<...>"}}function s(){return Error("react-stack-top-frame")}function i(){var t=e(this.type);return O[t]||(O[t]=!0),void 0!==(t=this.props.ref)?t:null}function l(t,a,n,s,l,c,u,g){var m,x=a.children;if(void 0!==x)if(s){if(C(x)){for(s=0;s<x.length;s++)o(x[s]);Object.freeze&&Object.freeze(x)}}else o(x);if(w.call(a,"key")){x=e(t);var h=Object.keys(a).filter(function(e){return"key"!==e});s=0<h.length?"{key: someKey, "+h.join(": ..., ")+": ...}":"{key: someKey}",I[x+s]||(h=0<h.length?"{"+h.join(": ..., ")+": ...}":"{}",I[x+s]=!0)}if(x=null,void 0!==n&&(r(n),x=""+n),function(e){if(w.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return void 0!==e.key}(a)&&(r(a.key),x=""+a.key),"key"in a)for(var f in n={},a)"key"!==f&&(n[f]=a[f]);else n=a;return x&&function(e){function t(){}t.isReactWarning=!0,Object.defineProperty(e,"key",{get:t,configurable:!0})}(n,"function"==typeof t&&(t.displayName||t.name)),function(e,t,a,r,n,s,l,o){return a=s.ref,e={$$typeof:d,type:e,key:t,props:s,_owner:n},null!==(void 0!==a?a:null)?Object.defineProperty(e,"ref",{enumerable:!1,get:i}):Object.defineProperty(e,"ref",{enumerable:!1,value:null}),e._store={},Object.defineProperty(e._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(e,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(e,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:l}),Object.defineProperty(e,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:o}),Object.freeze&&(Object.freeze(e.props),Object.freeze(e)),e}(t,x,c,0,null===(m=N.A)?null:m.getOwner(),n,u,g)}function o(e){"object"==typeof e&&null!==e&&e.$$typeof===d&&e._store&&(e._store.validated=1)}var c=t,d=Symbol.for("react.transitional.element"),u=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),m=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),h=Symbol.for("react.consumer"),f=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),j=Symbol.for("react.lazy"),k=Symbol.for("react.activity"),S=Symbol.for("react.client.reference"),N=c.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,w=Object.prototype.hasOwnProperty,C=Array.isArray,T=console.createTask?console.createTask:function(){return null},O={},z=(c={"react-stack-bottom-frame":function(e){return e()}})["react-stack-bottom-frame"].bind(c,s)(),E=T(n(s)),I={};W.Fragment=g,W.jsx=function(e,t,a,r,s){var i=1e4>N.recentlyCreatedOwnerStacks++;return l(e,t,a,!1,0,s,i?Error("react-stack-top-frame"):z,i?T(n(e)):E)},W.jsxs=function(e,t,a,r,s){var i=1e4>N.recentlyCreatedOwnerStacks++;return l(e,t,a,!0,0,s,i?Error("react-stack-top-frame"):z,i?T(n(e)):E)}}()),W}var X=(U||(U=1,"production"===process.env.NODE_ENV?L.exports=function(){if(V)return P;V=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function a(t,a,r){var n=null;if(void 0!==r&&(n=""+r),void 0!==a.key&&(n=""+a.key),"key"in a)for(var s in r={},a)"key"!==s&&(r[s]=a[s]);else r=a;return a=r.ref,{$$typeof:e,type:t,key:n,ref:void 0!==a?a:null,props:r}}return P.Fragment=t,P.jsx=a,P.jsxs=a,P}():L.exports=Y()),L.exports);function Z(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(a[r[n]]=e[r[n]])}return a}"function"==typeof SuppressedError&&SuppressedError;const K=(...e)=>b(v(e)),M=f("inline-flex items-center cursor-pointer justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function H(e){var{className:t,variant:a,size:r,asChild:n=!1}=e,s=Z(e,["className","variant","size","asChild"]);const i=n?h:"button";return X.jsx(i,Object.assign({"data-slot":"button",className:K(M({variant:a,size:r,className:t}))},s))}const G=({x:e,y:t,size:a=20,onDelete:r})=>{const n=e=>{e.evt.preventDefault(),r()};return X.jsxs(l,{x:e,y:t,onClick:n,onTap:n,children:[X.jsx(o,{width:a,height:a,radius:a/2,fill:"#000000",stroke:"#ffffff",strokeWidth:1,shadowBlur:2,shadowColor:"#000000",shadowOpacity:.2,opacity:.9,onClick:n,onTap:n}),X.jsx(c,{text:"x",fontSize:a,fill:"#ffffff",width:a,onClick:n,onTap:n,height:a,align:"center",verticalAlign:"middle",offsetX:a/2,offsetY:a/2})]})},q=({textElement:e,onDragEnd:t,onTransform:s,onSelect:i,transformerRef:o,onDelete:g,onDragStart:m})=>{var x,h;const f=a(null),v=a(null),[,b]=r({});n(()=>{var t;(null==o?void 0:o.current)&&v.current&&e.isSelected&&(o.current.nodes([v.current]),null===(t=o.current.getLayer())||void 0===t||t.batchDraw())},[e.isSelected,o]),n(()=>{if((null==o?void 0:o.current)&&v.current&&e.isSelected){const e=setTimeout(()=>{var e,t;o.current&&v.current&&(o.current.forceUpdate(),null===(e=o.current.getLayer())||void 0===e||e.batchDraw(),null===(t=v.current.getLayer())||void 0===t||t.batchDraw(),b({}))},0);return()=>clearTimeout(e)}},[e,o]);const p=()=>{if(v.current&&f.current){const t=v.current,a=t.scaleX(),r=t.scaleY(),n=t.x(),i=t.y(),l=t.rotation(),c=Object.assign(Object.assign({},f.current),{x:()=>n,y:()=>i,rotation:()=>l,scaleX:()=>a,scaleY:()=>r,fontSize:()=>e.fontSize,width:()=>{var e;return(null===(e=f.current)||void 0===e?void 0:e.width())||0},height:()=>{var e;return(null===(e=f.current)||void 0===e?void 0:e.height())||0}});s(c),setTimeout(()=>{var e,t;(null==o?void 0:o.current)&&v.current&&(o.current.forceUpdate(),null===(e=o.current.getLayer())||void 0===e||e.batchDraw(),null===(t=v.current.getLayer())||void 0===t||t.batchDraw(),b({}))},0)}},y=(null===(x=f.current)||void 0===x?void 0:x.width())||0,j=(null===(h=f.current)||void 0===h?void 0:h.height())||0,k=e.scaleX||1,S=e.scaleY||1,N=8/k,w=8/S,C=y+2*N,T=j+2*w,O=(()=>{if(!e.hasBackground)return{x:0,y:0};let t=0;return e.align,t=N,{x:t,y:0}})(),z=(()=>{if(!o||!o.current||!v.current)return{x:e.x+100,y:e.y-10};const t=o.current.findOne(".top-right");if(t){const e=t.getAbsolutePosition();return{x:e.x+10,y:e.y-10}}{const e=v.current.getClientRect();return{x:e.x+e.width+10,y:e.y-10}}})();return X.jsxs(X.Fragment,{children:[X.jsxs(l,{ref:v,x:e.x,y:e.y,rotation:e.rotation,scaleX:e.scaleX||1,scaleY:e.scaleY||1,draggable:!0,onDragEnd:t,onTransformEnd:p,onTransformStart:p,onClick:i,onTap:i,onDragStart:m,children:[e.hasBackground&&X.jsx(d,{x:-N,y:-w,width:C,height:T,fill:e.backgroundColor,opacity:e.backgroundOpacity,cornerRadius:e.backgroundRadius,shadowColor:e.isSelected?"#4A90E2":"transparent",shadowBlur:e.isSelected?5:0,shadowOpacity:e.isSelected?.3:0,stroke:e.hasBorder?e.borderColor:void 0,strokeWidth:e.hasBorder?e.borderWidth:0}),X.jsx(c,{ref:f,id:e.id,text:e.text,x:O.x,fontVariant:e.fontVariant,y:O.y,fontSize:e.fontSize,fontFamily:e.fontFamily,fill:e.fill,fontStyle:e.fontStyle,opacity:e.opacity,align:e.align,width:e.hasBackground?y:void 0,stroke:e.hasBorder?e.borderColor:void 0,strokeWidth:e.hasBorder?e.borderWidth:0,padding:8,wrap:"none"})]}),e.isSelected&&o&&X.jsx(u,{ref:o,boundBoxFunc:(e,t)=>t.width<20||t.height<20?e:t,rotateEnabled:!0,borderStroke:"#4A90E2",enabledAnchors:["top-left","top-right","bottom-left","bottom-right","bottom-center","top-center"],borderStrokeWidth:2,anchorFill:"#4A90E2",anchorStroke:"#4A90E2",anchorSize:8,keepRatio:!1,centeredScaling:!1}),e.isSelected&&o&&X.jsx(G,{x:z.x,y:z.y,onDelete:g})]})},J=e=>(t,a,r)=>{const n=r.subscribe;r.subscribe=(e,t,a)=>{let s=e;if(t){const n=(null==a?void 0:a.equalityFn)||Object.is;let i=e(r.getState());s=a=>{const r=e(a);if(!n(i,r)){const e=i;t(i=r,e)}},(null==a?void 0:a.fireImmediately)&&t(i,i)}return n(s)};return e(t,a,r)},Q=p()(J(y((e,t)=>({stickers:[],availableStickers:[{name:"Sticker 7",src:"/7.svg"},{name:"Sticker 8",src:"/8.svg"},{name:"Sticker 1",src:"/1.svg"},{name:"Sticker 2",src:"/2.svg"},{name:"Sticker 3",src:"/3.svg"},{name:"Sticker 4",src:"/4.svg"},{name:"Sticker 5",src:"/5.svg"},{name:"Sticker 6",src:"/6.svg"}],textElements:[],currentTextInput:"",bgImageObj:null,canvasSize:{width:1024,height:700},maxZIndex:0,setStickers:t=>e(e=>({stickers:"function"==typeof t?t(e.stickers):t})),setAvailableStickers:t=>e(e=>({availableStickers:"function"==typeof t?t(e.availableStickers):t})),setTextElements:t=>e(e=>({textElements:"function"==typeof t?t(e.textElements):t})),setCurrentTextInput:t=>e({currentTextInput:t}),setBgImageObj:t=>e({bgImageObj:t}),setCanvasSize:t=>e({canvasSize:t}),setMaxZIndex:t=>e({maxZIndex:t}),bringToFront:(a,r)=>{const n=t(),s=n.maxZIndex+1;"text"===r?e({textElements:n.textElements.map(e=>e.id===a?Object.assign(Object.assign({},e),{zIndex:s}):e),maxZIndex:s}):"sticker"===r&&e({stickers:n.stickers.map(e=>e.id===a?Object.assign(Object.assign({},e),{zIndex:s}):e),maxZIndex:s})},clearSelectedStickers:()=>{e({stickers:t().stickers.map(e=>Object.assign(Object.assign({},e),{isSelected:!1}))})},update:t=>{e(e=>{var a,r,n,s,i,l,o;return{stickers:null!==(a=t.stickers)&&void 0!==a?a:e.stickers,availableStickers:null!==(r=t.availableStickers)&&void 0!==r?r:e.availableStickers,textElements:null!==(n=t.textElements)&&void 0!==n?n:e.textElements,currentTextInput:null!==(s=t.currentTextInput)&&void 0!==s?s:e.currentTextInput,bgImageObj:null!==(i=t.bgImageObj)&&void 0!==i?i:e.bgImageObj,canvasSize:null!==(l=t.canvasSize)&&void 0!==l?l:e.canvasSize,maxZIndex:null!==(o=t.maxZIndex)&&void 0!==o?o:e.maxZIndex}})}}),{partialize:e=>({stickers:e.stickers,textElements:e.textElements,maxZIndex:e.maxZIndex,bgImageObj:e.bgImageObj}),limit:50,equality:(e,t)=>JSON.stringify(e)===JSON.stringify(t)}))),ee=()=>{const{undo:e,redo:t,clear:a}=Q.temporal.getState();return{undo:e,redo:t,clear:a}},te=()=>{const{stickers:e,setStickers:t,availableStickers:a,setAvailableStickers:r,setTextElements:n,maxZIndex:s,setMaxZIndex:i,bringToFront:l}=Q(),o=()=>{n(e=>e.map(e=>Object.assign(Object.assign({},e),{isSelected:!1})))};return{stickers:e,setStickers:t,availableStickers:a,addSticker:e=>{const a=s+1;t(t=>[...t.map(e=>Object.assign(Object.assign({},e),{isSelected:!1})),{id:`sticker-${Date.now()}`,x:100,y:100,rotation:0,scaleX:1,scaleY:1,isSelected:!0,src:e,zIndex:a}]),o(),i(a)},addAvailableSticker:e=>{r(t=>[...t,{name:`Sticker ${t.length+1}`,src:e}])},handleStickerDragEnd:(e,a)=>{t(t=>t.map(t=>t.id===e?Object.assign(Object.assign({},t),{x:a.target.x(),y:a.target.y()}):t))},handleStickerTransform:(e,a)=>{t(t=>t.map(t=>t.id===e?Object.assign(Object.assign({},t),{x:a.x(),y:a.y(),rotation:a.rotation(),scaleX:a.scaleX(),scaleY:a.scaleY()}):t))},handleStickerSelect:e=>{t(t=>t.map(t=>Object.assign(Object.assign({},t),{isSelected:t.id===e}))),o(),l(e,"sticker")},handleStickerRemove:e=>{t(t=>t.filter(t=>t.id!==e))},handleStickerDragStart:e=>{o(),t(t=>t.map(t=>Object.assign(Object.assign({},t),{isSelected:t.id===e})))}}},ae={fontSize:30,fontFamily:"Arial",fill:"#000000",rotation:0,scaleX:1,scaleY:1,fontVariant:"normal",fontStyle:"normal",align:"center",opacity:1,hasBackground:!1,backgroundColor:"#ffffff",backgroundOpacity:.8,backgroundRadius:0,hasBorder:!1,borderColor:"#000000",borderWidth:2,zIndex:0},re=()=>{const{textElements:e,setTextElements:t,currentTextInput:r,setCurrentTextInput:n,maxZIndex:i,setMaxZIndex:l,bringToFront:o,clearSelectedStickers:c}=Q(),d=a(null),u=s(()=>e.find(e=>e.isSelected)||null,[e]),g=e=>{t(t=>t.map(t=>{const a=t.id===e;return a&&n(t.text),Object.assign(Object.assign({},t),{isSelected:a})}))},m=(e,a)=>{t(t=>t.map(t=>t.id===e?Object.assign(Object.assign({},t),a):t))},x=a=>{var r;const n=a||(null===(r=e.find(e=>e.isSelected))||void 0===r?void 0:r.id);n&&t(e=>e.filter(e=>e.id!==n))};return{textElements:e,selectedTextElement:u,currentTextInput:r,setTextContent:a=>{c();const r=e.find(e=>e.isSelected);r?(n(a),m(r.id,{text:a})):a.trim()&&(e=>{const a=i+1,r=Object.assign(Object.assign({id:`text-${Date.now()}-${Math.random()}`,text:e,x:200,y:200},ae),{zIndex:a,isSelected:!0});t(e=>[...e.map(e=>Object.assign(Object.assign({},e),{isSelected:!1})),r]),l(a)})(a)},handleTextDragStart:t=>{c();const a=e.find(e=>e.id===t);a&&!a.isSelected&&g(t)},handleTextDragEnd:(e,t)=>{const a={x:t.target.x(),y:t.target.y()};m(e,a)},handleTextTransform:(e,t)=>{const a={x:t.x(),y:t.y(),rotation:t.rotation(),scaleX:t.scaleX(),scaleY:t.scaleY(),fontSize:t.fontSize()};m(e,a)},handleTextSelect:e=>{c(),g(e),o(e,"text")},removeText:x,handleStyleChange:(t,a)=>{const r=e.find(e=>e.isSelected);r&&m(r.id,{[t]:a})},makeCaps:()=>{const t=e.find(e=>e.isSelected);t&&m(t.id,{fontVariant:"normal"===t.fontVariant?"small-caps":"normal"})},deselectAll:()=>{t(e=>e.map(e=>Object.assign(Object.assign({},e),{isSelected:!1})));const a=e.find(e=>e.isSelected);a&&!a.text.trim()&&x(a.id),n("")},getCurrentTextStyle:()=>{const t=e.find(e=>e.isSelected)||ae;return{fontSize:t.fontSize,fontFamily:t.fontFamily,fill:t.fill,fontStyle:t.fontStyle,align:t.align,opacity:t.opacity,hasBackground:t.hasBackground,backgroundColor:t.backgroundColor,backgroundOpacity:t.backgroundOpacity,backgroundRadius:t.backgroundRadius,hasBorder:t.hasBorder,borderColor:t.borderColor,borderWidth:t.borderWidth,zIndex:t.zIndex,fontVariant:t.fontVariant}},changeTextStyle:t=>{const a=e.find(e=>e.isSelected);a&&m(a.id,{fontStyle:t})},changeTextAlign:t=>{const a=e.find(e=>e.isSelected);a&&m(a.id,{align:t})},controlsRef:d}},ne=()=>{const{textElements:e,removeText:t}=re(),{stickers:a,handleStickerRemove:r}=te(),i=s(()=>{var t;return null===(t=e.find(e=>!0===e.isSelected))||void 0===t?void 0:t.id},[e]),l=s(()=>{var e;return null===(e=a.find(e=>!0===e.isSelected))||void 0===e?void 0:e.id},[a]);n(()=>{const e=e=>{const a=document.activeElement;"INPUT"===(null==a?void 0:a.tagName)||"TEXTAREA"===(null==a?void 0:a.tagName)||("Delete"!==e.key&&"Backspace"!==e.key||(e.preventDefault(),i?t(i):l&&r(l)),(e.ctrlKey||e.metaKey)&&"Delete"===e.key&&(e.preventDefault(),i?t(i):l&&r(l)),(e.ctrlKey||e.metaKey)&&"Backspace"===e.key&&(e.preventDefault(),i?t(i):l&&r(l)))};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[i,l,t,r])},se=({stickerElement:e,onDragEnd:t,onTransform:s,onSelect:i,transformerRef:o,onDragStart:c,onStickerRemove:d})=>{ne();const m=a(null),[x,h]=j(e.src,"anonymous"),[f,v]=r({x:e.x,y:e.y});n(()=>{var t;if(e.isSelected&&"loaded"===h&&(null==o?void 0:o.current)){const a=o.current.getStage(),r=null==a?void 0:a.findOne(`#${e.id}`);r&&(o.current.nodes([r]),null===(t=o.current.getLayer())||void 0===t||t.batchDraw()),b()}},[e.isSelected,h,o,e.id]),n(()=>{e.isSelected&&"loaded"===h&&b()},[e.x,e.y,e.rotation,e.scaleX,e.scaleY,h]);const b=()=>{if(!m.current||"loaded"!==h)return;const e=m.current.getClientRect();v({x:e.x+e.width+20-10,y:e.y-20+7})};return X.jsxs(X.Fragment,{children:[X.jsx(l,{ref:m,children:X.jsx(g,{id:e.id,image:x,x:e.x,y:e.y,rotation:e.rotation,scaleX:e.scaleX,scaleY:e.scaleY,draggable:!0,onDragEnd:t,onDragStart:c,onTransformEnd:e=>{const t=e.target;s(t)},onClick:i,onTap:i})}),e.isSelected&&"loaded"===h&&o&&X.jsx(u,{ref:o,rotateEnabled:!0,borderStroke:"#4A90E2",borderStrokeWidth:2,anchorFill:"#4A90E2",anchorStroke:"#4A90E2",anchorSize:8}),e.isSelected&&X.jsx(G,{x:f.x,y:f.y,onDelete:()=>d(e.id)})]})};function ie(e){var{className:t,type:a}=e,r=Z(e,["className","type"]);return X.jsx("input",Object.assign({type:a,"data-slot":"input",className:K("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t)},r))}const le=({availableStickers:e,addSticker:t,addAvailableSticker:r})=>{const n=a(null);return X.jsx("div",{className:"p-4 rounded-lg border bg-gray-900",children:X.jsx("div",{className:"space-y-4",children:X.jsxs("div",{children:[X.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:e.map(e=>X.jsx(H,{variant:"outline",onClick:()=>{return a=e.src,void t(a);var a},children:X.jsx("img",{src:e.src,alt:e.name,className:"w-7 h-7"})},e.src))}),X.jsx(ie,{type:"file",accept:"image/*",ref:n,onChange:e=>{var a;const n=null===(a=e.target.files)||void 0===a?void 0:a[0];if(!n)return;const s=new FileReader;s.onload=e=>{var a;const n=null===(a=e.target)||void 0===a?void 0:a.result;r(n),t(n)},s.readAsDataURL(n)},className:"mt-2"})]})})})},oe=()=>{const{undo:e,redo:t}=ee();return X.jsxs("div",{className:"p-4 rounded-lg border bg-gray-900",children:[X.jsx("h3",{className:"text-lg font-semibold mb-4",children:"History"}),X.jsxs("div",{className:"flex gap-2",children:[X.jsxs(H,{variant:"outline",size:"sm",onClick:()=>e(1),className:"flex items-center gap-2",children:[X.jsx(k,{className:"w-4 h-4"}),"Undo"]}),X.jsxs(H,{variant:"outline",size:"sm",onClick:()=>t(1),className:"flex items-center gap-2",children:[X.jsx(S,{className:"w-4 h-4"}),"Redo"]})]})]})},ce=({bgImageObj:e,onBackgroundUpload:t,onRemoveBackground:r})=>{const n=a(null),s=()=>{var e;null===(e=n.current)||void 0===e||e.click()};return X.jsx("div",{className:"p-4 rounded-lg border bg-gray-900",children:X.jsxs("div",{className:"space-y-4",children:[X.jsx("h3",{className:"text-sm font-medium text-white",children:"Background Image"}),e?X.jsxs("div",{className:"space-y-3",children:[X.jsx("div",{className:"flex items-center justify-between",children:X.jsxs(H,{variant:"destructive",size:"sm",onClick:r,children:[X.jsx(w,{className:"h-4 w-4"}),"Remove"]})}),X.jsxs(H,{variant:"outline",onClick:s,className:"w-full",children:[X.jsx(N,{className:"h-4 w-4 mr-2"}),"Change Background"]})]}):X.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-600 rounded-lg",children:[X.jsx(N,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),X.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Upload a background image to get started"}),X.jsx(H,{onClick:s,className:"mb-2",children:"Upload Background"}),X.jsx("p",{className:"text-xs text-gray-500",children:"You need to upload a background image before adding text or stickers"})]}),X.jsx(ie,{type:"file",accept:"image/*",ref:n,onChange:e=>{var a;const r=null===(a=e.target.files)||void 0===a?void 0:a[0];r&&t(r)},className:"hidden"})]})})};function de(e){var{className:t}=e,a=Z(e,["className"]);return X.jsx(D.Root,Object.assign({"data-slot":"tabs",className:K("flex flex-col gap-2",t)},a))}function ue(e){var{className:t}=e,a=Z(e,["className"]);return X.jsx(D.List,Object.assign({"data-slot":"tabs-list",className:K("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t)},a))}function ge(e){var{className:t}=e,a=Z(e,["className"]);return X.jsx(D.Trigger,Object.assign({"data-slot":"tabs-trigger",className:K("data-[state=active]:bg-background cursor-pointer dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t)},a))}function me(e){var{className:t}=e,a=Z(e,["className"]);return X.jsx(D.Content,Object.assign({"data-slot":"tabs-content",className:K("flex-1 outline-none",t)},a))}function xe(e){var{className:t}=e,a=Z(e,["className"]);return X.jsx(R.Root,Object.assign({"data-slot":"label",className:K("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t)},a))}function he(e){var t=Z(e,[]);return X.jsx(B.Root,Object.assign({"data-slot":"select"},t))}function fe(e){var t=Z(e,[]);return X.jsx(B.Value,Object.assign({"data-slot":"select-value"},t))}function ve(e){var{className:t,size:a="default",children:r}=e,n=Z(e,["className","size","children"]);return X.jsxs(B.Trigger,Object.assign({"data-slot":"select-trigger","data-size":a,className:K("border-input cursor-pointer data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t)},n,{children:[r,X.jsx(B.Icon,{asChild:!0,children:X.jsx(C,{className:"size-4 opacity-50"})})]}))}function be(e){var{className:t,children:a,position:r="popper"}=e,n=Z(e,["className","children","position"]);return X.jsx(B.Portal,{children:X.jsxs(B.Content,Object.assign({"data-slot":"select-content",className:K("bg-popover cursor-pointer text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r},n,{children:[X.jsx(ye,{}),X.jsx(B.Viewport,{className:K("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] cursor-pointer w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),X.jsx(je,{})]}))})}function pe(e){var{className:t,children:a}=e,r=Z(e,["className","children"]);return X.jsxs(B.Item,Object.assign({"data-slot":"select-item",className:K("focus:bg-accent cursor-pointer focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t)},r,{children:[X.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:X.jsx(B.ItemIndicator,{children:X.jsx(T,{className:"size-4"})})}),X.jsx(B.ItemText,{children:a})]}))}function ye(e){var{className:t}=e,a=Z(e,["className"]);return X.jsx(B.ScrollUpButton,Object.assign({"data-slot":"select-scroll-up-button",className:K("flex cursor-default items-center justify-center py-1",t)},a,{children:X.jsx(O,{className:"size-4"})}))}function je(e){var{className:t}=e,a=Z(e,["className"]);return X.jsx(B.ScrollDownButton,Object.assign({"data-slot":"select-scroll-down-button",className:K("flex cursor-default items-center justify-center py-1",t)},a,{children:X.jsx(C,{className:"size-4"})}))}function ke(t){var{className:a,defaultValue:r,value:n,min:s=0,max:i=100}=t,l=Z(t,["className","defaultValue","value","min","max"]);const o=e.useMemo(()=>Array.isArray(n)?n:Array.isArray(r)?r:[s,i],[n,r,s,i]);return X.jsxs(F.Root,Object.assign({"data-slot":"slider",defaultValue:r,value:n,min:s,max:i,className:K("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",a)},l,{children:[X.jsx(F.Track,{"data-slot":"slider-track",className:K("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:X.jsx(F.Range,{"data-slot":"slider-range",className:K("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:o.length},(e,t)=>X.jsx(F.Thumb,{"data-slot":"slider-thumb",className:"border-primary cursor-pointer bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},t))]}))}const Se=["#FF0000","#FFFFFF","#000000","#00FFFF","#00FF00","#FFFF00","#0000FF","#FF6347","#008080","#800080"],Ne=({value:e,onChange:t})=>X.jsxs("div",{className:"flex gap-2 items-center flex-wrap",children:[X.jsx(ie,{type:"color",value:e.startsWith("#")?e:"#000000",onChange:e=>t(e.target.value),className:"w-12 h-8 p-0 border-2 rounded-lg cursor-pointer"}),Se.map((a,r)=>X.jsx("div",{className:"w-8 h-8 rounded-full border-2 cursor-pointer transition-all hover:scale-110 "+(e===a?"border-gray-800 shadow-lg":"border-gray-300"),style:{backgroundColor:a},onClick:()=>t(a),title:a},r))]}),we=({textStyle:e,handleStyleChange:t})=>{const[a,n]=r("hex"),[s,i]=r(e.fill);return X.jsxs("div",{className:"space-y-4",children:[X.jsx("div",{children:X.jsx(xe,{className:"text-sm font-medium",children:"Text Color"})}),X.jsx(Ne,{value:e.fill,onChange:e=>{i(e),t("fill",e)}}),X.jsxs("div",{className:"flex gap-2 items-center",children:[X.jsxs(he,{value:a,onValueChange:e=>n(e),children:[X.jsx(ve,{className:"w-24",children:X.jsx(fe,{})}),X.jsxs(be,{children:[X.jsx(pe,{value:"hex",children:"Hex"}),X.jsx(pe,{value:"rgb",children:"RGB"}),X.jsx(pe,{value:"string",children:"String"})]})]}),X.jsx(ie,{type:"text",value:s,onChange:e=>{i(e.target.value)},onBlur:()=>{t("fill",s)},onKeyDown:e=>{"Enter"===e.key&&(t("fill",s),e.currentTarget.blur())},className:"flex-1"})]}),X.jsxs("div",{children:[X.jsx(xe,{children:"Text Opacity"}),X.jsx(ke,{value:[e.opacity],onValueChange:([e])=>t("opacity",e),min:0,max:1,step:.01,className:"mt-2"})]})]})};function Ce(e){var{className:t}=e,a=Z(e,["className"]);return X.jsx(A.Root,Object.assign({"data-slot":"switch",className:K("peer cursor-pointer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t)},a,{children:X.jsx(A.Thumb,{"data-slot":"switch-thumb",className:K("bg-background cursor-pointer dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})}))}const Te=({textStyle:e,handleStyleChange:t})=>{const[a,s]=r("hex"),[i,l]=r(e.backgroundColor);n(()=>{l(e.backgroundColor)},[e.backgroundColor]);return X.jsxs("div",{className:"space-y-4",children:[X.jsxs("div",{className:"flex items-center justify-between",children:[X.jsx(xe,{className:"text-sm font-medium",children:"Text Background"}),X.jsx(Ce,{checked:e.hasBackground,onCheckedChange:e=>t("hasBackground",e)})]}),e.hasBackground&&X.jsxs("div",{className:"space-y-4",children:[X.jsx("div",{children:X.jsx(xe,{className:"text-sm font-medium",children:"Background Color"})}),X.jsx(Ne,{value:e.backgroundColor,onChange:e=>{l(e),t("backgroundColor",e)}}),X.jsxs("div",{className:"flex gap-2 items-center",children:[X.jsxs(he,{value:a,onValueChange:e=>s(e),children:[X.jsx(ve,{className:"w-24",children:X.jsx(fe,{})}),X.jsxs(be,{children:[X.jsx(pe,{value:"hex",children:"Hex"}),X.jsx(pe,{value:"rgb",children:"RGB"}),X.jsx(pe,{value:"string",children:"String"})]})]}),X.jsx(ie,{type:"text",value:i,onChange:e=>{l(e.target.value)},onBlur:()=>{t("backgroundColor",i)},onKeyDown:e=>{"Enter"===e.key&&(t("backgroundColor",i),e.currentTarget.blur())},className:"flex-1"})]}),X.jsxs("div",{children:[X.jsx(xe,{children:"Background Opacity"}),X.jsx(ke,{value:[e.backgroundOpacity],onValueChange:([e])=>t("backgroundOpacity",e),min:0,max:1,step:.01,className:"mt-2"})]}),X.jsxs("div",{children:[X.jsx(xe,{children:"Background Radius"}),X.jsx(ke,{value:[e.backgroundRadius],onValueChange:([e])=>t("backgroundRadius",e),min:0,max:50,step:1,className:"mt-2"})]})]})]})},Oe=({textStyle:e,handleStyleChange:t})=>{const[a,s]=r("hex"),[i,l]=r(e.borderColor);n(()=>{l(e.borderColor)},[e.borderColor]);return X.jsxs("div",{className:"space-y-4",children:[X.jsxs("div",{className:"flex items-center justify-between",children:[X.jsx(xe,{className:"text-sm font-medium",children:"Text Border"}),X.jsx(Ce,{checked:e.hasBorder,onCheckedChange:e=>t("hasBorder",e)})]}),e.hasBorder&&X.jsxs("div",{className:"space-y-4",children:[X.jsx("div",{children:X.jsx(xe,{className:"text-sm font-medium",children:"Border Color"})}),X.jsx(Ne,{value:e.borderColor,onChange:e=>{l(e),t("borderColor",e)}}),X.jsxs("div",{className:"flex gap-2 items-center",children:[X.jsxs(he,{value:a,onValueChange:e=>s(e),children:[X.jsx(ve,{className:"w-24",children:X.jsx(fe,{})}),X.jsxs(be,{children:[X.jsx(pe,{value:"hex",children:"Hex"}),X.jsx(pe,{value:"rgb",children:"RGB"}),X.jsx(pe,{value:"string",children:"String"})]})]}),X.jsx(ie,{type:"text",value:i,onChange:e=>{l(e.target.value)},onBlur:()=>{t("borderColor",i)},onKeyDown:e=>{"Enter"===e.key&&(t("borderColor",i),e.currentTarget.blur())},className:"flex-1"})]}),X.jsxs("div",{children:[X.jsx(xe,{children:"Border Width"}),X.jsx(ke,{value:[e.borderWidth],onValueChange:([e])=>t("borderWidth",e),min:0,max:20,step:.5,className:"mt-2"})]})]})]})},ze=["Arial","Helvetica","Garamond","Comic Sans MS","Arial Black","Impact"],Ee=({textContent:e,textStyle:t,handleStyleChange:a})=>X.jsxs("div",{className:"space-y-4",children:[X.jsxs("div",{children:[X.jsx(xe,{children:"Font Family"}),X.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2",children:ze.map(r=>X.jsx(H,{onClick:()=>a("fontFamily",r),variant:e&&t.fontFamily===r?"outline":"ghost",className:"justify-start border",style:{fontFamily:r},children:r},r))})]}),X.jsxs("div",{children:[X.jsxs(xe,{children:["Font Size: ",Math.round(t.fontSize),"px"]}),X.jsx(ke,{value:[t.fontSize],onValueChange:([e])=>a("fontSize",e),min:12,disabled:!1==!!e,max:100,step:1,className:"mt-2"})]})]});function Ie(e){var{className:t}=e,a=Z(e,["className"]);return X.jsx("textarea",Object.assign({"data-slot":"textarea",className:K("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t)},a))}const De=({textContent:e,textStyle:t,makeCaps:a,changeTextStyle:r,changeTextAlign:n,setTextContent:s,selectedTextElement:i})=>X.jsxs("div",{className:"space-y-4",children:[X.jsx(xe,{children:"Text Input"}),X.jsx("div",{className:"flex gap-2",children:X.jsx(Ie,{value:e,onChange:e=>s(e.target.value),placeholder:"Type to add text...",className:"mt-1 min-h-32"})}),X.jsxs("div",{className:"flex gap-2",children:[X.jsx(H,{onClick:a,variant:"small-caps"===(null==i?void 0:i.fontVariant)?"default":"ghost",className:"capitalize",children:"T"}),X.jsx(H,{onClick:()=>r("bold"==(null==i?void 0:i.fontStyle)?"normal":"bold"),variant:"bold"===t.fontStyle?"default":"ghost",className:"font-extrabold",children:"B"}),X.jsx(H,{onClick:()=>r("italic"==(null==i?void 0:i.fontStyle)?"normal":"italic"),variant:"italic"===t.fontStyle?"default":"ghost",className:"italic",children:"I"}),X.jsx("span",{className:"border border-white"}),X.jsx(H,{onClick:()=>n("left"),variant:e&&"left"===t.align?"default":"ghost",children:X.jsx(z,{})}),X.jsx(H,{onClick:()=>n("center"),variant:e&&"center"===t.align?"default":"ghost",children:X.jsx(E,{})}),X.jsx(H,{onClick:()=>n("right"),variant:e&&"right"===t.align?"default":"ghost",children:X.jsx(I,{})})]})]});function Re(e){var{className:t,orientation:a="horizontal",decorative:r=!0}=e,n=Z(e,["className","orientation","decorative"]);return X.jsx(_.Root,Object.assign({"data-slot":"separator",decorative:r,orientation:a,className:K("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t)},n))}const Be=i(({textContent:e,setTextContent:t,textStyle:a,handleStyleChange:r,makeCaps:n,changeTextStyle:s,changeTextAlign:i,selectedTextElement:l},o)=>X.jsx("div",{className:"p-4 rounded-lg border bg-gray-900",ref:o,tabIndex:-1,children:X.jsxs(de,{defaultValue:"text",className:"w-full",children:[X.jsxs(ue,{className:"grid w-full grid-cols-3",children:[X.jsx(ge,{value:"text",children:"Text"}),X.jsx(ge,{value:"color",children:"Color"}),X.jsx(ge,{value:"font",children:"Font"})]}),X.jsx(me,{value:"text",children:X.jsx("div",{className:"space-y-4",children:X.jsx(De,{textContent:e,setTextContent:t,makeCaps:n,changeTextAlign:i,selectedTextElement:l,changeTextStyle:s,textStyle:a})})}),X.jsx(me,{value:"color",children:X.jsxs("div",{className:"space-y-4",children:[X.jsx(we,{textStyle:a,handleStyleChange:r}),X.jsx(Re,{}),X.jsx(Te,{textStyle:a,handleStyleChange:r}),X.jsx(Re,{}),X.jsx(Oe,{textStyle:a,handleStyleChange:r})]})}),X.jsx(me,{value:"font",children:X.jsx("div",{className:"space-y-4",children:X.jsx(Ee,{textContent:e,textStyle:a,handleStyleChange:r})})})]})}));Be.displayName="TextControls";const Fe=()=>{const{stageRef:e,transformerRef:t,textElements:r,currentTextInput:s,setTextContent:i,handleTextDragEnd:l,handleTextTransform:o,handleTextSelect:c,handleStageClick:d,removeText:u,downloadImage:h,bgImageObj:f,canvasSize:v,handleBackgroundUpload:b,removeBackground:p,stickers:y,availableStickers:j,addSticker:k,addAvailableSticker:S,handleStickerDragEnd:N,handleStickerTransform:w,handleStickerSelect:C,handleStyleChange:T,handleStickerRemove:O,makeCaps:z,textStyle:E,changeTextStyle:I,changeTextAlign:D,controlsRef:R,handleTextDragStart:B,handleStickerDragStart:F,selectedTextElement:A}=(()=>{const e=a(null),t=a(null),{bgImageObj:r,setBgImageObj:n,setTextElements:s,canvasSize:i,setCanvasSize:l,setCurrentTextInput:o}=Q(),{textElements:c,currentTextInput:d,setTextContent:u,handleTextDragEnd:g,handleTextTransform:m,handleTextSelect:x,removeText:h,handleStyleChange:f,makeCaps:v,deselectAll:b,getCurrentTextStyle:p,changeTextStyle:y,changeTextAlign:j,controlsRef:k,handleTextDragStart:S,selectedTextElement:N}=re(),{stickers:w,setStickers:C,availableStickers:T,addSticker:O,addAvailableSticker:z,handleStickerDragEnd:E,handleStickerTransform:I,handleStickerSelect:D,handleStickerRemove:R,handleStickerDragStart:B}=te(),F=()=>{s([]),C([]),o("")};return{stageRef:e,transformerRef:t,textElements:c,currentTextInput:d,setTextContent:u,handleTextDragEnd:g,handleTextTransform:m,handleTextSelect:x,removeText:h,handleStyleChange:f,makeCaps:v,textStyle:p(),handleStageClick:e=>{var a,r;2===e.target._id&&1===(null===(a=e.target.getStage())||void 0===a?void 0:a._id)&&(b(),C(e=>e.map(e=>Object.assign(Object.assign({},e),{isSelected:!1}))),t.current&&(t.current.nodes([]),null===(r=t.current.getLayer())||void 0===r||r.batchDraw()))},downloadImage:()=>{var a;e.current&&r&&(s(e=>e.map(e=>Object.assign(Object.assign({},e),{isSelected:!1}))),C(e=>e.map(e=>Object.assign(Object.assign({},e),{isSelected:!1}))),t.current&&(t.current.nodes([]),null===(a=t.current.getLayer())||void 0===a||a.batchDraw()),setTimeout(()=>{if(e.current){e.current.width(i.width),e.current.height(i.height),e.current.batchDraw();const t=e.current.toDataURL({pixelRatio:1,width:i.width,height:i.height,x:0,y:0}),a=document.createElement("a");a.download=`composition_${i.width}x${i.height}.png`,a.href=t,a.click()}},100))},bgImageObj:r,canvasSize:i,handleBackgroundUpload:e=>{F();const t=new FileReader;t.onload=e=>{var t;const a=new window.Image;a.crossOrigin="anonymous",a.onload=()=>{const e={width:a.naturalWidth,height:a.naturalHeight};l(e),n(a)},a.onerror=e=>{console.error("Error loading image:",e)},a.src=null===(t=e.target)||void 0===t?void 0:t.result},t.readAsDataURL(e)},removeBackground:()=>{n(null),l({width:1024,height:700}),F()},stickers:w,availableStickers:T,addSticker:O,addAvailableSticker:z,handleStickerDragEnd:E,handleStickerTransform:I,handleStickerSelect:D,handleStickerRemove:R,changeTextStyle:y,changeTextAlign:j,controlsRef:k,handleTextDragStart:S,handleStickerDragStart:B,selectedTextElement:N}})();(()=>{const{undo:e,redo:t}=ee();n(()=>{const a=a=>{const r=a.ctrlKey||a.metaKey;r&&"z"===a.key&&!a.shiftKey?(a.preventDefault(),e()):r&&("y"===a.key||"z"===a.key&&a.shiftKey)&&(a.preventDefault(),t())};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[e,t])})(),ne();const _=[...r.map(e=>Object.assign(Object.assign({},e),{type:"text"})),...y.map(e=>Object.assign(Object.assign({},e),{type:"sticker"}))].sort((e,t)=>e.zIndex-t.zIndex);return X.jsx("div",{className:"p-4 max-w-full mx-auto",children:X.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[X.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[X.jsx(ce,{bgImageObj:f,onBackgroundUpload:b,onRemoveBackground:p}),f&&X.jsxs(X.Fragment,{children:[X.jsx(Be,{textContent:s,setTextContent:i,textStyle:E,handleStyleChange:T,makeCaps:z,selectedTextElement:A,ref:R,changeTextStyle:I,changeTextAlign:D}),X.jsx(le,{availableStickers:j,addSticker:k,addAvailableSticker:S})]}),X.jsx(oe,{})]}),X.jsxs("div",{className:"lg:col-span-3",children:[X.jsx("div",{className:"border rounded-lg mb-4 inline-block",children:f?X.jsx("div",{className:"inline-block",style:{width:v.width,height:v.height},children:X.jsx(m,{width:v.width,height:v.height,ref:e,onClick:d,onTap:d,children:X.jsxs(x,{children:[X.jsx(g,{image:f,x:0,y:0,width:v.width,height:v.height,draggable:!1}),_.map(e=>"sticker"===e.type?X.jsx(se,{stickerElement:e,stickerImage:(()=>{const t=new window.Image;return t.src=e.src,t.crossOrigin="anonymous",t})(),onDragEnd:t=>N(e.id,t),onDragStart:()=>F(e.id),onTransform:t=>w(e.id,t),onSelect:()=>C(e.id),transformerRef:e.isSelected?t:null,onStickerRemove:O},e.id):X.jsx(q,{textElement:e,onDragEnd:t=>l(e.id,t),onDragStart:()=>B(e.id),onDelete:()=>u(e.id),onTransform:t=>o(e.id,t),onSelect:()=>c(e.id),transformerRef:e.isSelected?t:null},e.id))]})})}):X.jsx("div",{className:"w-[1024px] h-[700px] bg-gray-100 flex items-center justify-center",children:X.jsxs("div",{className:"text-center",children:[X.jsx("div",{className:"text-gray-400 text-lg mb-2",children:"No background image"}),X.jsx("div",{className:"text-gray-500 text-sm",children:"Upload a background image to start editing"})]})})}),X.jsx("div",{className:"flex gap-2",children:X.jsx(H,{onClick:h,disabled:!f,children:"Download Image"})})]})]})})};export{Fe as default};
//# sourceMappingURL=index.esm.js.map
