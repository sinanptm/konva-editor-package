"use strict";var e=require("react"),t=require("react-konva"),a=require("@radix-ui/react-slot"),r=require("class-variance-authority"),n=require("clsx"),s=require("tailwind-merge"),i=require("zustand"),l=require("zundo"),o=require("use-image"),c=require("lucide-react"),d=require("@radix-ui/react-tabs"),u=require("@radix-ui/react-label"),g=require("@radix-ui/react-select"),x=require("@radix-ui/react-slider"),m=require("@radix-ui/react-switch"),h=require("@radix-ui/react-separator");function f(e){var t=Object.create(null);return e&&Object.keys(e).forEach(function(a){if("default"!==a){var r=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,r.get?r:{enumerable:!0,get:function(){return e[a]}})}}),t.default=e,Object.freeze(t)}var v,b=f(e),p=f(d),y=f(u),j=f(g),k=f(x),S=f(m),N=f(h),w={exports:{}},C={};var T,O,E={};
/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function z(){return T||(T=1,"production"!==process.env.NODE_ENV&&function(){function t(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===S?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case g:return"Fragment";case m:return"Profiler";case x:return"StrictMode";case b:return"Suspense";case p:return"SuspenseList";case k:return"Activity"}if("object"==typeof e)switch(e.tag,e.$$typeof){case u:return"Portal";case f:return(e.displayName||"Context")+".Provider";case h:return(e._context.displayName||"Context")+".Consumer";case v:var a=e.render;return(e=e.displayName)||(e=""!==(e=a.displayName||a.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case y:return null!==(a=e.displayName||null)?a:t(e.type)||"Memo";case j:a=e._payload,e=e._init;try{return t(e(a))}catch(e){}}return null}function a(e){return""+e}function r(e){try{a(e);var t=!1}catch(e){t=!0}if(t){var r=(t=console).error,n="function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object";return r.call(t,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",n),a(e)}}function n(e){if(e===g)return"<>";if("object"==typeof e&&null!==e&&e.$$typeof===j)return"<...>";try{var a=t(e);return a?"<"+a+">":"<...>"}catch(e){return"<...>"}}function s(){return Error("react-stack-top-frame")}function i(){var e=t(this.type);return O[e]||(O[e]=!0),void 0!==(e=this.props.ref)?e:null}function l(e,a,n,s,l,c,u,g){var x,m=a.children;if(void 0!==m)if(s){if(C(m)){for(s=0;s<m.length;s++)o(m[s]);Object.freeze&&Object.freeze(m)}}else o(m);if(w.call(a,"key")){m=t(e);var h=Object.keys(a).filter(function(e){return"key"!==e});s=0<h.length?"{key: someKey, "+h.join(": ..., ")+": ...}":"{key: someKey}",R[m+s]||(h=0<h.length?"{"+h.join(": ..., ")+": ...}":"{}",R[m+s]=!0)}if(m=null,void 0!==n&&(r(n),m=""+n),function(e){if(w.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return void 0!==e.key}(a)&&(r(a.key),m=""+a.key),"key"in a)for(var f in n={},a)"key"!==f&&(n[f]=a[f]);else n=a;return m&&function(e){function t(){}t.isReactWarning=!0,Object.defineProperty(e,"key",{get:t,configurable:!0})}(n,"function"==typeof e&&(e.displayName||e.name)),function(e,t,a,r,n,s,l,o){return a=s.ref,e={$$typeof:d,type:e,key:t,props:s,_owner:n},null!==(void 0!==a?a:null)?Object.defineProperty(e,"ref",{enumerable:!1,get:i}):Object.defineProperty(e,"ref",{enumerable:!1,value:null}),e._store={},Object.defineProperty(e._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(e,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(e,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:l}),Object.defineProperty(e,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:o}),Object.freeze&&(Object.freeze(e.props),Object.freeze(e)),e}(e,m,c,0,null===(x=N.A)?null:x.getOwner(),n,u,g)}function o(e){"object"==typeof e&&null!==e&&e.$$typeof===d&&e._store&&(e._store.validated=1)}var c=e,d=Symbol.for("react.transitional.element"),u=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),m=Symbol.for("react.profiler"),h=Symbol.for("react.consumer"),f=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),j=Symbol.for("react.lazy"),k=Symbol.for("react.activity"),S=Symbol.for("react.client.reference"),N=c.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,w=Object.prototype.hasOwnProperty,C=Array.isArray,T=console.createTask?console.createTask:function(){return null},O={},z=(c={"react-stack-bottom-frame":function(e){return e()}})["react-stack-bottom-frame"].bind(c,s)(),I=T(n(s)),R={};E.Fragment=g,E.jsx=function(e,t,a,r,s){var i=1e4>N.recentlyCreatedOwnerStacks++;return l(e,t,a,!1,0,s,i?Error("react-stack-top-frame"):z,i?T(n(e)):I)},E.jsxs=function(e,t,a,r,s){var i=1e4>N.recentlyCreatedOwnerStacks++;return l(e,t,a,!0,0,s,i?Error("react-stack-top-frame"):z,i?T(n(e)):I)}}()),E}var I=(O||(O=1,"production"===process.env.NODE_ENV?w.exports=function(){if(v)return C;v=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function a(t,a,r){var n=null;if(void 0!==r&&(n=""+r),void 0!==a.key&&(n=""+a.key),"key"in a)for(var s in r={},a)"key"!==s&&(r[s]=a[s]);else r=a;return a=r.ref,{$$typeof:e,type:t,key:n,ref:void 0!==a?a:null,props:r}}return C.Fragment=t,C.jsx=a,C.jsxs=a,C}():w.exports=z()),w.exports);function R(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(a[r[n]]=e[r[n]])}return a}"function"==typeof SuppressedError&&SuppressedError;const D=(...e)=>s.twMerge(n.clsx(e)),B=r.cva("inline-flex items-center cursor-pointer justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function A(e){var{className:t,variant:r,size:n,asChild:s=!1}=e,i=R(e,["className","variant","size","asChild"]);const l=s?a.Slot:"button";return I.jsx(l,Object.assign({"data-slot":"button",className:D(B({variant:r,size:n,className:t}))},i))}const F=({x:e,y:a,size:r=20,onDelete:n})=>{const s=e=>{e.evt.preventDefault(),n()};return I.jsxs(t.Group,{x:e,y:a,onClick:s,onTap:s,children:[I.jsx(t.Circle,{width:r,height:r,radius:r/2,fill:"#000000",stroke:"#ffffff",strokeWidth:1,shadowBlur:2,shadowColor:"#000000",shadowOpacity:.2,opacity:.9,onClick:s,onTap:s}),I.jsx(t.Text,{text:"x",fontSize:r,fill:"#ffffff",width:r,onClick:s,onTap:s,height:r,align:"center",verticalAlign:"middle",offsetX:r/2,offsetY:r/2})]})},_=({textElement:a,onDragEnd:r,onTransform:n,onSelect:s,transformerRef:i,onDelete:l,onDragStart:o})=>{var c,d;const u=e.useRef(null),g=e.useRef(null),[,x]=e.useState({});e.useEffect(()=>{var e;(null==i?void 0:i.current)&&g.current&&a.isSelected&&(i.current.nodes([g.current]),null===(e=i.current.getLayer())||void 0===e||e.batchDraw())},[a.isSelected,i]),e.useEffect(()=>{if((null==i?void 0:i.current)&&g.current&&a.isSelected){const e=setTimeout(()=>{var e,t;i.current&&g.current&&(i.current.forceUpdate(),null===(e=i.current.getLayer())||void 0===e||e.batchDraw(),null===(t=g.current.getLayer())||void 0===t||t.batchDraw(),x({}))},0);return()=>clearTimeout(e)}},[a,i]);const m=()=>{if(g.current&&u.current){const e=g.current,t=e.scaleX(),r=e.scaleY(),s=e.x(),l=e.y(),o=e.rotation(),c=Object.assign(Object.assign({},u.current),{x:()=>s,y:()=>l,rotation:()=>o,scaleX:()=>t,scaleY:()=>r,fontSize:()=>a.fontSize,width:()=>{var e;return(null===(e=u.current)||void 0===e?void 0:e.width())||0},height:()=>{var e;return(null===(e=u.current)||void 0===e?void 0:e.height())||0}});n(c),setTimeout(()=>{var e,t;(null==i?void 0:i.current)&&g.current&&(i.current.forceUpdate(),null===(e=i.current.getLayer())||void 0===e||e.batchDraw(),null===(t=g.current.getLayer())||void 0===t||t.batchDraw(),x({}))},0)}},h=(null===(c=u.current)||void 0===c?void 0:c.width())||0,f=(null===(d=u.current)||void 0===d?void 0:d.height())||0,v=a.scaleX||1,b=a.scaleY||1,p=8/v,y=8/b,j=h+2*p,k=f+2*y,S=(()=>{if(!a.hasBackground)return{x:0,y:0};let e=0;return a.align,e=p,{x:e,y:0}})(),N=(()=>{if(!i||!i.current||!g.current)return{x:a.x+100,y:a.y-10};const e=i.current.findOne(".top-right");if(e){const t=e.getAbsolutePosition();return{x:t.x+10,y:t.y-10}}{const e=g.current.getClientRect();return{x:e.x+e.width+10,y:e.y-10}}})();return I.jsxs(I.Fragment,{children:[I.jsxs(t.Group,{ref:g,x:a.x,y:a.y,rotation:a.rotation,scaleX:a.scaleX||1,scaleY:a.scaleY||1,draggable:!0,onDragEnd:r,onTransformEnd:m,onTransformStart:m,onClick:s,onTap:s,onDragStart:o,children:[a.hasBackground&&I.jsx(t.Rect,{x:-p,y:-y,width:j,height:k,fill:a.backgroundColor,opacity:a.backgroundOpacity,cornerRadius:a.backgroundRadius,shadowColor:a.isSelected?"#4A90E2":"transparent",shadowBlur:a.isSelected?5:0,shadowOpacity:a.isSelected?.3:0,stroke:a.hasBorder?a.borderColor:void 0,strokeWidth:a.hasBorder?a.borderWidth:0}),I.jsx(t.Text,{ref:u,id:a.id,text:a.text,x:S.x,fontVariant:a.fontVariant,y:S.y,fontSize:a.fontSize,fontFamily:a.fontFamily,fill:a.fill,fontStyle:a.fontStyle,opacity:a.opacity,align:a.align,width:a.hasBackground?h:void 0,stroke:a.hasBorder?a.borderColor:void 0,strokeWidth:a.hasBorder?a.borderWidth:0,padding:8,wrap:"none"})]}),a.isSelected&&i&&I.jsx(t.Transformer,{ref:i,boundBoxFunc:(e,t)=>t.width<20||t.height<20?e:t,rotateEnabled:!0,borderStroke:"#4A90E2",enabledAnchors:["top-left","top-right","bottom-left","bottom-right","bottom-center","top-center"],borderStrokeWidth:2,anchorFill:"#4A90E2",anchorStroke:"#4A90E2",anchorSize:8,keepRatio:!1,centeredScaling:!1}),a.isSelected&&i&&I.jsx(F,{x:N.x,y:N.y,onDelete:l})]})},V=e=>(t,a,r)=>{const n=r.subscribe;r.subscribe=(e,t,a)=>{let s=e;if(t){const n=(null==a?void 0:a.equalityFn)||Object.is;let i=e(r.getState());s=a=>{const r=e(a);if(!n(i,r)){const e=i;t(i=r,e)}},(null==a?void 0:a.fireImmediately)&&t(i,i)}return n(s)};return e(t,a,r)},U=i.create()(V(l.temporal((e,t)=>({stickers:[],availableStickers:[{name:"Sticker 7",src:"/7.svg"},{name:"Sticker 8",src:"/8.svg"},{name:"Sticker 1",src:"/1.svg"},{name:"Sticker 2",src:"/2.svg"},{name:"Sticker 3",src:"/3.svg"},{name:"Sticker 4",src:"/4.svg"},{name:"Sticker 5",src:"/5.svg"},{name:"Sticker 6",src:"/6.svg"}],textElements:[],currentTextInput:"",bgImageObj:null,canvasSize:{width:1024,height:700},maxZIndex:0,setStickers:t=>e(e=>({stickers:"function"==typeof t?t(e.stickers):t})),setAvailableStickers:t=>e(e=>({availableStickers:"function"==typeof t?t(e.availableStickers):t})),setTextElements:t=>e(e=>({textElements:"function"==typeof t?t(e.textElements):t})),setCurrentTextInput:t=>e({currentTextInput:t}),setBgImageObj:t=>e({bgImageObj:t}),setCanvasSize:t=>e({canvasSize:t}),setMaxZIndex:t=>e({maxZIndex:t}),bringToFront:(a,r)=>{const n=t(),s=n.maxZIndex+1;"text"===r?e({textElements:n.textElements.map(e=>e.id===a?Object.assign(Object.assign({},e),{zIndex:s}):e),maxZIndex:s}):"sticker"===r&&e({stickers:n.stickers.map(e=>e.id===a?Object.assign(Object.assign({},e),{zIndex:s}):e),maxZIndex:s})},clearSelectedStickers:()=>{e({stickers:t().stickers.map(e=>Object.assign(Object.assign({},e),{isSelected:!1}))})},update:t=>{e(e=>{var a,r,n,s,i,l,o;return{stickers:null!==(a=t.stickers)&&void 0!==a?a:e.stickers,availableStickers:null!==(r=t.availableStickers)&&void 0!==r?r:e.availableStickers,textElements:null!==(n=t.textElements)&&void 0!==n?n:e.textElements,currentTextInput:null!==(s=t.currentTextInput)&&void 0!==s?s:e.currentTextInput,bgImageObj:null!==(i=t.bgImageObj)&&void 0!==i?i:e.bgImageObj,canvasSize:null!==(l=t.canvasSize)&&void 0!==l?l:e.canvasSize,maxZIndex:null!==(o=t.maxZIndex)&&void 0!==o?o:e.maxZIndex}})}}),{partialize:e=>({stickers:e.stickers,textElements:e.textElements,maxZIndex:e.maxZIndex,bgImageObj:e.bgImageObj}),limit:50,equality:(e,t)=>JSON.stringify(e)===JSON.stringify(t)}))),L=()=>{const{undo:e,redo:t,clear:a}=U.temporal.getState();return{undo:e,redo:t,clear:a}},P=()=>{const{stickers:e,setStickers:t,availableStickers:a,setAvailableStickers:r,setTextElements:n,maxZIndex:s,setMaxZIndex:i,bringToFront:l}=U(),o=()=>{n(e=>e.map(e=>Object.assign(Object.assign({},e),{isSelected:!1})))};return{stickers:e,setStickers:t,availableStickers:a,addSticker:e=>{const a=s+1;t(t=>[...t.map(e=>Object.assign(Object.assign({},e),{isSelected:!1})),{id:`sticker-${Date.now()}`,x:100,y:100,rotation:0,scaleX:1,scaleY:1,isSelected:!0,src:e,zIndex:a}]),o(),i(a)},addAvailableSticker:e=>{r(t=>[...t,{name:`Sticker ${t.length+1}`,src:e}])},handleStickerDragEnd:(e,a)=>{t(t=>t.map(t=>t.id===e?Object.assign(Object.assign({},t),{x:a.target.x(),y:a.target.y()}):t))},handleStickerTransform:(e,a)=>{t(t=>t.map(t=>t.id===e?Object.assign(Object.assign({},t),{x:a.x(),y:a.y(),rotation:a.rotation(),scaleX:a.scaleX(),scaleY:a.scaleY()}):t))},handleStickerSelect:e=>{t(t=>t.map(t=>Object.assign(Object.assign({},t),{isSelected:t.id===e}))),o(),l(e,"sticker")},handleStickerRemove:e=>{t(t=>t.filter(t=>t.id!==e))},handleStickerDragStart:e=>{o(),t(t=>t.map(t=>Object.assign(Object.assign({},t),{isSelected:t.id===e})))}}},$={fontSize:30,fontFamily:"Arial",fill:"#000000",rotation:0,scaleX:1,scaleY:1,fontVariant:"normal",fontStyle:"normal",align:"center",opacity:1,hasBackground:!1,backgroundColor:"#ffffff",backgroundOpacity:.8,backgroundRadius:0,hasBorder:!1,borderColor:"#000000",borderWidth:2,zIndex:0},q=()=>{const{textElements:t,setTextElements:a,currentTextInput:r,setCurrentTextInput:n,maxZIndex:s,setMaxZIndex:i,bringToFront:l,clearSelectedStickers:o}=U(),c=e.useRef(null),d=e.useMemo(()=>t.find(e=>e.isSelected)||null,[t]),u=e=>{a(t=>t.map(t=>{const a=t.id===e;return a&&n(t.text),Object.assign(Object.assign({},t),{isSelected:a})}))},g=(e,t)=>{a(a=>a.map(a=>a.id===e?Object.assign(Object.assign({},a),t):a))},x=e=>{var r;const n=e||(null===(r=t.find(e=>e.isSelected))||void 0===r?void 0:r.id);n&&a(e=>e.filter(e=>e.id!==n))};return{textElements:t,selectedTextElement:d,currentTextInput:r,setTextContent:e=>{o();const r=t.find(e=>e.isSelected);r?(n(e),g(r.id,{text:e})):e.trim()&&(e=>{const t=s+1,r=Object.assign(Object.assign({id:`text-${Date.now()}-${Math.random()}`,text:e,x:200,y:200},$),{zIndex:t,isSelected:!0});a(e=>[...e.map(e=>Object.assign(Object.assign({},e),{isSelected:!1})),r]),i(t)})(e)},handleTextDragStart:e=>{o();const a=t.find(t=>t.id===e);a&&!a.isSelected&&u(e)},handleTextDragEnd:(e,t)=>{const a={x:t.target.x(),y:t.target.y()};g(e,a)},handleTextTransform:(e,t)=>{const a={x:t.x(),y:t.y(),rotation:t.rotation(),scaleX:t.scaleX(),scaleY:t.scaleY(),fontSize:t.fontSize()};g(e,a)},handleTextSelect:e=>{o(),u(e),l(e,"text")},removeText:x,handleStyleChange:(e,a)=>{const r=t.find(e=>e.isSelected);r&&g(r.id,{[e]:a})},makeCaps:()=>{const e=t.find(e=>e.isSelected);e&&g(e.id,{fontVariant:"normal"===e.fontVariant?"small-caps":"normal"})},deselectAll:()=>{a(e=>e.map(e=>Object.assign(Object.assign({},e),{isSelected:!1})));const e=t.find(e=>e.isSelected);e&&!e.text.trim()&&x(e.id),n("")},getCurrentTextStyle:()=>{const e=t.find(e=>e.isSelected)||$;return{fontSize:e.fontSize,fontFamily:e.fontFamily,fill:e.fill,fontStyle:e.fontStyle,align:e.align,opacity:e.opacity,hasBackground:e.hasBackground,backgroundColor:e.backgroundColor,backgroundOpacity:e.backgroundOpacity,backgroundRadius:e.backgroundRadius,hasBorder:e.hasBorder,borderColor:e.borderColor,borderWidth:e.borderWidth,zIndex:e.zIndex,fontVariant:e.fontVariant}},changeTextStyle:e=>{const a=t.find(e=>e.isSelected);a&&g(a.id,{fontStyle:e})},changeTextAlign:e=>{const a=t.find(e=>e.isSelected);a&&g(a.id,{align:e})},controlsRef:c}},W=()=>{const{textElements:t,removeText:a}=q(),{stickers:r,handleStickerRemove:n}=P(),s=e.useMemo(()=>{var e;return null===(e=t.find(e=>!0===e.isSelected))||void 0===e?void 0:e.id},[t]),i=e.useMemo(()=>{var e;return null===(e=r.find(e=>!0===e.isSelected))||void 0===e?void 0:e.id},[r]);e.useEffect(()=>{const e=e=>{const t=document.activeElement;"INPUT"===(null==t?void 0:t.tagName)||"TEXTAREA"===(null==t?void 0:t.tagName)||("Delete"!==e.key&&"Backspace"!==e.key||(e.preventDefault(),s?a(s):i&&n(i)),(e.ctrlKey||e.metaKey)&&"Delete"===e.key&&(e.preventDefault(),s?a(s):i&&n(i)),(e.ctrlKey||e.metaKey)&&"Backspace"===e.key&&(e.preventDefault(),s?a(s):i&&n(i)))};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[s,i,a,n])},X=({stickerElement:a,onDragEnd:r,onTransform:n,onSelect:s,transformerRef:i,onDragStart:l,onStickerRemove:c})=>{W();const d=e.useRef(null),[u,g]=o(a.src,"anonymous"),[x,m]=e.useState({x:a.x,y:a.y});e.useEffect(()=>{var e;if(a.isSelected&&"loaded"===g&&(null==i?void 0:i.current)){const t=i.current.getStage(),r=null==t?void 0:t.findOne(`#${a.id}`);r&&(i.current.nodes([r]),null===(e=i.current.getLayer())||void 0===e||e.batchDraw()),h()}},[a.isSelected,g,i,a.id]),e.useEffect(()=>{a.isSelected&&"loaded"===g&&h()},[a.x,a.y,a.rotation,a.scaleX,a.scaleY,g]);const h=()=>{if(!d.current||"loaded"!==g)return;const e=d.current.getClientRect();m({x:e.x+e.width+20-10,y:e.y-20+7})};return I.jsxs(I.Fragment,{children:[I.jsx(t.Group,{ref:d,children:I.jsx(t.Image,{id:a.id,image:u,x:a.x,y:a.y,rotation:a.rotation,scaleX:a.scaleX,scaleY:a.scaleY,draggable:!0,onDragEnd:r,onDragStart:l,onTransformEnd:e=>{const t=e.target;n(t)},onClick:s,onTap:s})}),a.isSelected&&"loaded"===g&&i&&I.jsx(t.Transformer,{ref:i,rotateEnabled:!0,borderStroke:"#4A90E2",borderStrokeWidth:2,anchorFill:"#4A90E2",anchorStroke:"#4A90E2",anchorSize:8}),a.isSelected&&I.jsx(F,{x:x.x,y:x.y,onDelete:()=>c(a.id)})]})};function Y(e){var{className:t,type:a}=e,r=R(e,["className","type"]);return I.jsx("input",Object.assign({type:a,"data-slot":"input",className:D("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t)},r))}const Z=({availableStickers:t,addSticker:a,addAvailableSticker:r})=>{const n=e.useRef(null);return I.jsx("div",{className:"p-4 rounded-lg border bg-gray-900",children:I.jsx("div",{className:"space-y-4",children:I.jsxs("div",{children:[I.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:t.map(e=>I.jsx(A,{variant:"outline",onClick:()=>{return t=e.src,void a(t);var t},children:I.jsx("img",{src:e.src,alt:e.name,className:"w-7 h-7"})},e.src))}),I.jsx(Y,{type:"file",accept:"image/*",ref:n,onChange:e=>{var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!n)return;const s=new FileReader;s.onload=e=>{var t;const n=null===(t=e.target)||void 0===t?void 0:t.result;r(n),a(n)},s.readAsDataURL(n)},className:"mt-2"})]})})})},K=()=>{const{undo:e,redo:t}=L();return I.jsxs("div",{className:"p-4 rounded-lg border bg-gray-900",children:[I.jsx("h3",{className:"text-lg font-semibold mb-4",children:"History"}),I.jsxs("div",{className:"flex gap-2",children:[I.jsxs(A,{variant:"outline",size:"sm",onClick:()=>e(1),className:"flex items-center gap-2",children:[I.jsx(c.Undo,{className:"w-4 h-4"}),"Undo"]}),I.jsxs(A,{variant:"outline",size:"sm",onClick:()=>t(1),className:"flex items-center gap-2",children:[I.jsx(c.Redo,{className:"w-4 h-4"}),"Redo"]})]})]})},M=({bgImageObj:t,onBackgroundUpload:a,onRemoveBackground:r})=>{const n=e.useRef(null),s=()=>{var e;null===(e=n.current)||void 0===e||e.click()};return I.jsx("div",{className:"p-4 rounded-lg border bg-gray-900",children:I.jsxs("div",{className:"space-y-4",children:[I.jsx("h3",{className:"text-sm font-medium text-white",children:"Background Image"}),t?I.jsxs("div",{className:"space-y-3",children:[I.jsx("div",{className:"flex items-center justify-between",children:I.jsxs(A,{variant:"destructive",size:"sm",onClick:r,children:[I.jsx(c.X,{className:"h-4 w-4"}),"Remove"]})}),I.jsxs(A,{variant:"outline",onClick:s,className:"w-full",children:[I.jsx(c.Upload,{className:"h-4 w-4 mr-2"}),"Change Background"]})]}):I.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-600 rounded-lg",children:[I.jsx(c.Upload,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),I.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Upload a background image to get started"}),I.jsx(A,{onClick:s,className:"mb-2",children:"Upload Background"}),I.jsx("p",{className:"text-xs text-gray-500",children:"You need to upload a background image before adding text or stickers"})]}),I.jsx(Y,{type:"file",accept:"image/*",ref:n,onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&a(r)},className:"hidden"})]})})};function G(e){var{className:t}=e,a=R(e,["className"]);return I.jsx(p.Root,Object.assign({"data-slot":"tabs",className:D("flex flex-col gap-2",t)},a))}function H(e){var{className:t}=e,a=R(e,["className"]);return I.jsx(p.List,Object.assign({"data-slot":"tabs-list",className:D("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t)},a))}function J(e){var{className:t}=e,a=R(e,["className"]);return I.jsx(p.Trigger,Object.assign({"data-slot":"tabs-trigger",className:D("data-[state=active]:bg-background cursor-pointer dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t)},a))}function Q(e){var{className:t}=e,a=R(e,["className"]);return I.jsx(p.Content,Object.assign({"data-slot":"tabs-content",className:D("flex-1 outline-none",t)},a))}function ee(e){var{className:t}=e,a=R(e,["className"]);return I.jsx(y.Root,Object.assign({"data-slot":"label",className:D("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t)},a))}function te(e){var t=R(e,[]);return I.jsx(j.Root,Object.assign({"data-slot":"select"},t))}function ae(e){var t=R(e,[]);return I.jsx(j.Value,Object.assign({"data-slot":"select-value"},t))}function re(e){var{className:t,size:a="default",children:r}=e,n=R(e,["className","size","children"]);return I.jsxs(j.Trigger,Object.assign({"data-slot":"select-trigger","data-size":a,className:D("border-input cursor-pointer data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t)},n,{children:[r,I.jsx(j.Icon,{asChild:!0,children:I.jsx(c.ChevronDownIcon,{className:"size-4 opacity-50"})})]}))}function ne(e){var{className:t,children:a,position:r="popper"}=e,n=R(e,["className","children","position"]);return I.jsx(j.Portal,{children:I.jsxs(j.Content,Object.assign({"data-slot":"select-content",className:D("bg-popover cursor-pointer text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:r},n,{children:[I.jsx(ie,{}),I.jsx(j.Viewport,{className:D("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] cursor-pointer w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),I.jsx(le,{})]}))})}function se(e){var{className:t,children:a}=e,r=R(e,["className","children"]);return I.jsxs(j.Item,Object.assign({"data-slot":"select-item",className:D("focus:bg-accent cursor-pointer focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t)},r,{children:[I.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:I.jsx(j.ItemIndicator,{children:I.jsx(c.CheckIcon,{className:"size-4"})})}),I.jsx(j.ItemText,{children:a})]}))}function ie(e){var{className:t}=e,a=R(e,["className"]);return I.jsx(j.ScrollUpButton,Object.assign({"data-slot":"select-scroll-up-button",className:D("flex cursor-default items-center justify-center py-1",t)},a,{children:I.jsx(c.ChevronUpIcon,{className:"size-4"})}))}function le(e){var{className:t}=e,a=R(e,["className"]);return I.jsx(j.ScrollDownButton,Object.assign({"data-slot":"select-scroll-down-button",className:D("flex cursor-default items-center justify-center py-1",t)},a,{children:I.jsx(c.ChevronDownIcon,{className:"size-4"})}))}function oe(e){var{className:t,defaultValue:a,value:r,min:n=0,max:s=100}=e,i=R(e,["className","defaultValue","value","min","max"]);const l=b.useMemo(()=>Array.isArray(r)?r:Array.isArray(a)?a:[n,s],[r,a,n,s]);return I.jsxs(k.Root,Object.assign({"data-slot":"slider",defaultValue:a,value:r,min:n,max:s,className:D("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",t)},i,{children:[I.jsx(k.Track,{"data-slot":"slider-track",className:D("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:I.jsx(k.Range,{"data-slot":"slider-range",className:D("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:l.length},(e,t)=>I.jsx(k.Thumb,{"data-slot":"slider-thumb",className:"border-primary cursor-pointer bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},t))]}))}const ce=["#FF0000","#FFFFFF","#000000","#00FFFF","#00FF00","#FFFF00","#0000FF","#FF6347","#008080","#800080"],de=({value:e,onChange:t})=>I.jsxs("div",{className:"flex gap-2 items-center flex-wrap",children:[I.jsx(Y,{type:"color",value:e.startsWith("#")?e:"#000000",onChange:e=>t(e.target.value),className:"w-12 h-8 p-0 border-2 rounded-lg cursor-pointer"}),ce.map((a,r)=>I.jsx("div",{className:"w-8 h-8 rounded-full border-2 cursor-pointer transition-all hover:scale-110 "+(e===a?"border-gray-800 shadow-lg":"border-gray-300"),style:{backgroundColor:a},onClick:()=>t(a),title:a},r))]}),ue=({textStyle:t,handleStyleChange:a})=>{const[r,n]=e.useState("hex"),[s,i]=e.useState(t.fill);return I.jsxs("div",{className:"space-y-4",children:[I.jsx("div",{children:I.jsx(ee,{className:"text-sm font-medium",children:"Text Color"})}),I.jsx(de,{value:t.fill,onChange:e=>{i(e),a("fill",e)}}),I.jsxs("div",{className:"flex gap-2 items-center",children:[I.jsxs(te,{value:r,onValueChange:e=>n(e),children:[I.jsx(re,{className:"w-24",children:I.jsx(ae,{})}),I.jsxs(ne,{children:[I.jsx(se,{value:"hex",children:"Hex"}),I.jsx(se,{value:"rgb",children:"RGB"}),I.jsx(se,{value:"string",children:"String"})]})]}),I.jsx(Y,{type:"text",value:s,onChange:e=>{i(e.target.value)},onBlur:()=>{a("fill",s)},onKeyDown:e=>{"Enter"===e.key&&(a("fill",s),e.currentTarget.blur())},className:"flex-1"})]}),I.jsxs("div",{children:[I.jsx(ee,{children:"Text Opacity"}),I.jsx(oe,{value:[t.opacity],onValueChange:([e])=>a("opacity",e),min:0,max:1,step:.01,className:"mt-2"})]})]})};function ge(e){var{className:t}=e,a=R(e,["className"]);return I.jsx(S.Root,Object.assign({"data-slot":"switch",className:D("peer cursor-pointer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t)},a,{children:I.jsx(S.Thumb,{"data-slot":"switch-thumb",className:D("bg-background cursor-pointer dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})}))}const xe=({textStyle:t,handleStyleChange:a})=>{const[r,n]=e.useState("hex"),[s,i]=e.useState(t.backgroundColor);e.useEffect(()=>{i(t.backgroundColor)},[t.backgroundColor]);return I.jsxs("div",{className:"space-y-4",children:[I.jsxs("div",{className:"flex items-center justify-between",children:[I.jsx(ee,{className:"text-sm font-medium",children:"Text Background"}),I.jsx(ge,{checked:t.hasBackground,onCheckedChange:e=>a("hasBackground",e)})]}),t.hasBackground&&I.jsxs("div",{className:"space-y-4",children:[I.jsx("div",{children:I.jsx(ee,{className:"text-sm font-medium",children:"Background Color"})}),I.jsx(de,{value:t.backgroundColor,onChange:e=>{i(e),a("backgroundColor",e)}}),I.jsxs("div",{className:"flex gap-2 items-center",children:[I.jsxs(te,{value:r,onValueChange:e=>n(e),children:[I.jsx(re,{className:"w-24",children:I.jsx(ae,{})}),I.jsxs(ne,{children:[I.jsx(se,{value:"hex",children:"Hex"}),I.jsx(se,{value:"rgb",children:"RGB"}),I.jsx(se,{value:"string",children:"String"})]})]}),I.jsx(Y,{type:"text",value:s,onChange:e=>{i(e.target.value)},onBlur:()=>{a("backgroundColor",s)},onKeyDown:e=>{"Enter"===e.key&&(a("backgroundColor",s),e.currentTarget.blur())},className:"flex-1"})]}),I.jsxs("div",{children:[I.jsx(ee,{children:"Background Opacity"}),I.jsx(oe,{value:[t.backgroundOpacity],onValueChange:([e])=>a("backgroundOpacity",e),min:0,max:1,step:.01,className:"mt-2"})]}),I.jsxs("div",{children:[I.jsx(ee,{children:"Background Radius"}),I.jsx(oe,{value:[t.backgroundRadius],onValueChange:([e])=>a("backgroundRadius",e),min:0,max:50,step:1,className:"mt-2"})]})]})]})},me=({textStyle:t,handleStyleChange:a})=>{const[r,n]=e.useState("hex"),[s,i]=e.useState(t.borderColor);e.useEffect(()=>{i(t.borderColor)},[t.borderColor]);return I.jsxs("div",{className:"space-y-4",children:[I.jsxs("div",{className:"flex items-center justify-between",children:[I.jsx(ee,{className:"text-sm font-medium",children:"Text Border"}),I.jsx(ge,{checked:t.hasBorder,onCheckedChange:e=>a("hasBorder",e)})]}),t.hasBorder&&I.jsxs("div",{className:"space-y-4",children:[I.jsx("div",{children:I.jsx(ee,{className:"text-sm font-medium",children:"Border Color"})}),I.jsx(de,{value:t.borderColor,onChange:e=>{i(e),a("borderColor",e)}}),I.jsxs("div",{className:"flex gap-2 items-center",children:[I.jsxs(te,{value:r,onValueChange:e=>n(e),children:[I.jsx(re,{className:"w-24",children:I.jsx(ae,{})}),I.jsxs(ne,{children:[I.jsx(se,{value:"hex",children:"Hex"}),I.jsx(se,{value:"rgb",children:"RGB"}),I.jsx(se,{value:"string",children:"String"})]})]}),I.jsx(Y,{type:"text",value:s,onChange:e=>{i(e.target.value)},onBlur:()=>{a("borderColor",s)},onKeyDown:e=>{"Enter"===e.key&&(a("borderColor",s),e.currentTarget.blur())},className:"flex-1"})]}),I.jsxs("div",{children:[I.jsx(ee,{children:"Border Width"}),I.jsx(oe,{value:[t.borderWidth],onValueChange:([e])=>a("borderWidth",e),min:0,max:20,step:.5,className:"mt-2"})]})]})]})},he=["Arial","Helvetica","Garamond","Comic Sans MS","Arial Black","Impact"],fe=({textContent:e,textStyle:t,handleStyleChange:a})=>I.jsxs("div",{className:"space-y-4",children:[I.jsxs("div",{children:[I.jsx(ee,{children:"Font Family"}),I.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2",children:he.map(r=>I.jsx(A,{onClick:()=>a("fontFamily",r),variant:e&&t.fontFamily===r?"outline":"ghost",className:"justify-start border",style:{fontFamily:r},children:r},r))})]}),I.jsxs("div",{children:[I.jsxs(ee,{children:["Font Size: ",Math.round(t.fontSize),"px"]}),I.jsx(oe,{value:[t.fontSize],onValueChange:([e])=>a("fontSize",e),min:12,disabled:!1==!!e,max:100,step:1,className:"mt-2"})]})]});function ve(e){var{className:t}=e,a=R(e,["className"]);return I.jsx("textarea",Object.assign({"data-slot":"textarea",className:D("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t)},a))}const be=({textContent:e,textStyle:t,makeCaps:a,changeTextStyle:r,changeTextAlign:n,setTextContent:s,selectedTextElement:i})=>I.jsxs("div",{className:"space-y-4",children:[I.jsx(ee,{children:"Text Input"}),I.jsx("div",{className:"flex gap-2",children:I.jsx(ve,{value:e,onChange:e=>s(e.target.value),placeholder:"Type to add text...",className:"mt-1 min-h-32"})}),I.jsxs("div",{className:"flex gap-2",children:[I.jsx(A,{onClick:a,variant:"small-caps"===(null==i?void 0:i.fontVariant)?"default":"ghost",className:"capitalize",children:"T"}),I.jsx(A,{onClick:()=>r("bold"==(null==i?void 0:i.fontStyle)?"normal":"bold"),variant:"bold"===t.fontStyle?"default":"ghost",className:"font-extrabold",children:"B"}),I.jsx(A,{onClick:()=>r("italic"==(null==i?void 0:i.fontStyle)?"normal":"italic"),variant:"italic"===t.fontStyle?"default":"ghost",className:"italic",children:"I"}),I.jsx("span",{className:"border border-white"}),I.jsx(A,{onClick:()=>n("left"),variant:e&&"left"===t.align?"default":"ghost",children:I.jsx(c.AlignLeftIcon,{})}),I.jsx(A,{onClick:()=>n("center"),variant:e&&"center"===t.align?"default":"ghost",children:I.jsx(c.AlignCenterIcon,{})}),I.jsx(A,{onClick:()=>n("right"),variant:e&&"right"===t.align?"default":"ghost",children:I.jsx(c.AlignRightIcon,{})})]})]});function pe(e){var{className:t,orientation:a="horizontal",decorative:r=!0}=e,n=R(e,["className","orientation","decorative"]);return I.jsx(N.Root,Object.assign({"data-slot":"separator",decorative:r,orientation:a,className:D("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t)},n))}const ye=e.forwardRef(({textContent:e,setTextContent:t,textStyle:a,handleStyleChange:r,makeCaps:n,changeTextStyle:s,changeTextAlign:i,selectedTextElement:l},o)=>I.jsx("div",{className:"p-4 rounded-lg border bg-gray-900",ref:o,tabIndex:-1,children:I.jsxs(G,{defaultValue:"text",className:"w-full",children:[I.jsxs(H,{className:"grid w-full grid-cols-3",children:[I.jsx(J,{value:"text",children:"Text"}),I.jsx(J,{value:"color",children:"Color"}),I.jsx(J,{value:"font",children:"Font"})]}),I.jsx(Q,{value:"text",children:I.jsx("div",{className:"space-y-4",children:I.jsx(be,{textContent:e,setTextContent:t,makeCaps:n,changeTextAlign:i,selectedTextElement:l,changeTextStyle:s,textStyle:a})})}),I.jsx(Q,{value:"color",children:I.jsxs("div",{className:"space-y-4",children:[I.jsx(ue,{textStyle:a,handleStyleChange:r}),I.jsx(pe,{}),I.jsx(xe,{textStyle:a,handleStyleChange:r}),I.jsx(pe,{}),I.jsx(me,{textStyle:a,handleStyleChange:r})]})}),I.jsx(Q,{value:"font",children:I.jsx("div",{className:"space-y-4",children:I.jsx(fe,{textContent:e,textStyle:a,handleStyleChange:r})})})]})}));ye.displayName="TextControls";module.exports=()=>{const{stageRef:a,transformerRef:r,textElements:n,currentTextInput:s,setTextContent:i,handleTextDragEnd:l,handleTextTransform:o,handleTextSelect:c,handleStageClick:d,removeText:u,downloadImage:g,bgImageObj:x,canvasSize:m,handleBackgroundUpload:h,removeBackground:f,stickers:v,availableStickers:b,addSticker:p,addAvailableSticker:y,handleStickerDragEnd:j,handleStickerTransform:k,handleStickerSelect:S,handleStyleChange:N,handleStickerRemove:w,makeCaps:C,textStyle:T,changeTextStyle:O,changeTextAlign:E,controlsRef:z,handleTextDragStart:R,handleStickerDragStart:D,selectedTextElement:B}=(()=>{const t=e.useRef(null),a=e.useRef(null),{bgImageObj:r,setBgImageObj:n,setTextElements:s,canvasSize:i,setCanvasSize:l,setCurrentTextInput:o}=U(),{textElements:c,currentTextInput:d,setTextContent:u,handleTextDragEnd:g,handleTextTransform:x,handleTextSelect:m,removeText:h,handleStyleChange:f,makeCaps:v,deselectAll:b,getCurrentTextStyle:p,changeTextStyle:y,changeTextAlign:j,controlsRef:k,handleTextDragStart:S,selectedTextElement:N}=q(),{stickers:w,setStickers:C,availableStickers:T,addSticker:O,addAvailableSticker:E,handleStickerDragEnd:z,handleStickerTransform:I,handleStickerSelect:R,handleStickerRemove:D,handleStickerDragStart:B}=P(),A=()=>{s([]),C([]),o("")};return{stageRef:t,transformerRef:a,textElements:c,currentTextInput:d,setTextContent:u,handleTextDragEnd:g,handleTextTransform:x,handleTextSelect:m,removeText:h,handleStyleChange:f,makeCaps:v,textStyle:p(),handleStageClick:e=>{var t,r;2===e.target._id&&1===(null===(t=e.target.getStage())||void 0===t?void 0:t._id)&&(b(),C(e=>e.map(e=>Object.assign(Object.assign({},e),{isSelected:!1}))),a.current&&(a.current.nodes([]),null===(r=a.current.getLayer())||void 0===r||r.batchDraw()))},downloadImage:()=>{var e;t.current&&r&&(s(e=>e.map(e=>Object.assign(Object.assign({},e),{isSelected:!1}))),C(e=>e.map(e=>Object.assign(Object.assign({},e),{isSelected:!1}))),a.current&&(a.current.nodes([]),null===(e=a.current.getLayer())||void 0===e||e.batchDraw()),setTimeout(()=>{if(t.current){t.current.width(i.width),t.current.height(i.height),t.current.batchDraw();const e=t.current.toDataURL({pixelRatio:1,width:i.width,height:i.height,x:0,y:0}),a=document.createElement("a");a.download=`composition_${i.width}x${i.height}.png`,a.href=e,a.click()}},100))},bgImageObj:r,canvasSize:i,handleBackgroundUpload:e=>{A();const t=new FileReader;t.onload=e=>{var t;const a=new window.Image;a.crossOrigin="anonymous",a.onload=()=>{const e={width:a.naturalWidth,height:a.naturalHeight};l(e),n(a)},a.onerror=e=>{console.error("Error loading image:",e)},a.src=null===(t=e.target)||void 0===t?void 0:t.result},t.readAsDataURL(e)},removeBackground:()=>{n(null),l({width:1024,height:700}),A()},stickers:w,availableStickers:T,addSticker:O,addAvailableSticker:E,handleStickerDragEnd:z,handleStickerTransform:I,handleStickerSelect:R,handleStickerRemove:D,changeTextStyle:y,changeTextAlign:j,controlsRef:k,handleTextDragStart:S,handleStickerDragStart:B,selectedTextElement:N}})();(()=>{const{undo:t,redo:a}=L();e.useEffect(()=>{const e=e=>{const r=e.ctrlKey||e.metaKey;r&&"z"===e.key&&!e.shiftKey?(e.preventDefault(),t()):r&&("y"===e.key||"z"===e.key&&e.shiftKey)&&(e.preventDefault(),a())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,a])})(),W();const F=[...n.map(e=>Object.assign(Object.assign({},e),{type:"text"})),...v.map(e=>Object.assign(Object.assign({},e),{type:"sticker"}))].sort((e,t)=>e.zIndex-t.zIndex);return I.jsx("div",{className:"p-4 max-w-full mx-auto",children:I.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[I.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[I.jsx(M,{bgImageObj:x,onBackgroundUpload:h,onRemoveBackground:f}),x&&I.jsxs(I.Fragment,{children:[I.jsx(ye,{textContent:s,setTextContent:i,textStyle:T,handleStyleChange:N,makeCaps:C,selectedTextElement:B,ref:z,changeTextStyle:O,changeTextAlign:E}),I.jsx(Z,{availableStickers:b,addSticker:p,addAvailableSticker:y})]}),I.jsx(K,{})]}),I.jsxs("div",{className:"lg:col-span-3",children:[I.jsx("div",{className:"border rounded-lg mb-4 inline-block",children:x?I.jsx("div",{className:"inline-block",style:{width:m.width,height:m.height},children:I.jsx(t.Stage,{width:m.width,height:m.height,ref:a,onClick:d,onTap:d,children:I.jsxs(t.Layer,{children:[I.jsx(t.Image,{image:x,x:0,y:0,width:m.width,height:m.height,draggable:!1}),F.map(e=>"sticker"===e.type?I.jsx(X,{stickerElement:e,stickerImage:(()=>{const t=new window.Image;return t.src=e.src,t.crossOrigin="anonymous",t})(),onDragEnd:t=>j(e.id,t),onDragStart:()=>D(e.id),onTransform:t=>k(e.id,t),onSelect:()=>S(e.id),transformerRef:e.isSelected?r:null,onStickerRemove:w},e.id):I.jsx(_,{textElement:e,onDragEnd:t=>l(e.id,t),onDragStart:()=>R(e.id),onDelete:()=>u(e.id),onTransform:t=>o(e.id,t),onSelect:()=>c(e.id),transformerRef:e.isSelected?r:null},e.id))]})})}):I.jsx("div",{className:"w-[1024px] h-[700px] bg-gray-100 flex items-center justify-center",children:I.jsxs("div",{className:"text-center",children:[I.jsx("div",{className:"text-gray-400 text-lg mb-2",children:"No background image"}),I.jsx("div",{className:"text-gray-500 text-sm",children:"Upload a background image to start editing"})]})})}),I.jsx("div",{className:"flex gap-2",children:I.jsx(A,{onClick:g,disabled:!x,children:"Download Image"})})]})]})})};
//# sourceMappingURL=index.js.map
